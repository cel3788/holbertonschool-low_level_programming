CC = gcc
SRC = main.c m1.c m2.c m3.c
OBJ = main.o m1.o m2.o m3.o
NAME = school
RM = rm -f
CFLAGS = -Wall -Werror -Wextra -pedantic
DEP = $(OBJ:.o=.d)

all: $(NAME)

-include $(DEP)

$(NAME): $(OBJ)
	$(CC) -o $@ $^

clean:
	-$(RM) clean
	-$(RM) $(wildcard *~) $(wildcard \#*\#) $(wildcard *.swp) $(wildcard *.o) $(NAME)

oclean:
	-$(RM) $(wildcard *.o)

fclean: clean
	-$(RM) $(NAME)

re: all

.PHONY: all clean oclean fclean re

ifneq ($(origin CC), undefined)
ifneq ($(words $(filter $(CC), $(MAKEFILE_LIST))), 1)
$(error Variable CC is defined and used at most 1 time, and its value is gcc)
endif
endif

ifneq ($(words $(RM)), 2)
$(error Variable RM is used more than 2 times)
endif

ifneq ($(wildcard m.h),m.h)
$(error make -f 100-Makefile should fail if file m.h is missing)
endif

ifneq ($(MAKECMDGOALS),re)
ifneq ($(MAKECMDGOALS),all)
-include $(DEP)
endif
endif

